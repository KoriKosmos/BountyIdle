<!DOCTYPE html>
<!-- The document type declaration for HTML5 -->
<html>
  <head>
    <!-- Set character encoding to UTF-8 -->
    <meta charset="utf-8" />
    <!-- Make the page responsive on all devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Page title -->
    <title>Bounty Office</title>
    <!-- Internal CSS styles for layout and appearance -->
    <style>
      /* Use system fonts for a modern look */
      :root { font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; }
      /* Set body background and text color */
      body { margin: 0; background: #0f1115; color: #e9e9ee; }
      /* Center content and set max width */
      .wrap { max-width: 560px; margin: 0 auto; padding: 24px; }
      /* Style the main heading */
      h1 { margin: 0 0 8px 0; font-size: 26px; }
      /* Card container for main content */
      .card { background: #14151c; border: 1px solid #232333; border-radius: 12px; padding: 14px; }
      /* Row layout for items inside the card */
      .row { display: flex; gap: 8px; align-items: center; margin: 10px 0; }
      /* Use tabular numbers for credit display */
      .num { font-variant-numeric: tabular-nums; }
      /* Style the button */
      button { padding: 10px 12px; border-radius: 10px; border: 1px solid #2b2b3a; background: #1b1b25; color: #fff; cursor: pointer; }
      /* Button hover effect */
      button:hover { background: #20212a; }
    </style>
  <body>
    <!-- Main wrapper for page content -->
  <!-- Reset Save Button in top right -->
  <button id="resetBtn" style="position: absolute; top: 18px; right: 24px; z-index: 10; padding: 8px 14px; border-radius: 8px; border: 1px solid #2b2b3a; background: #1b1b25; color: #fff; cursor: pointer;">Reset Save</button>
  <div style="display: flex; flex-direction: row;">
    <!-- Crew Sidebar -->
    <div id="crewArea" class="card" style="min-width: 200px; margin: 18px 0 18px 24px; display: flex; flex-direction: column; align-items: flex-start; padding: 18px;">
      <h1 style="font-size: 26px; margin: 0 0 18px 0;">Crew</h1>
      <div id="hireRow" style="margin-bottom: 16px; display:none; width: 100%;">
        <div style="display: flex; align-items: center;">
          <button id="hireBtn" style="margin-left: 0;">Hire Novice Hunter</button>
          <span id="hireCostSpan" style="margin-left: 12px;">Hired: 0</span>
        </div>
        <div id="hirePerTick" style="font-size: 13px; color: #aaa; margin-top: 2px; margin-left: 2px;">+0.5 credits/tick</div>
        <div id="hireCostBelow" style="font-size: 13px; color: #aaa; margin-top: 2px; margin-left: 2px;">Cost 20</div>
      </div>
    </div>
    <!-- Main wrapper for page content -->
    <div class="wrap" style="flex: 1;">
      <!-- Page title -->
      <h1>Bounty Office</h1>
      <!-- Card displays credits and action button -->
      <div class="card">
        <div class="row">
          <span>Credits:</span>
          <strong class="num" id="credits">0</strong>
        </div>
        <div class="row">
          <button id="huntBtn">Hunt petty bounty</button>
          <span>+1 credit</span>
        </div>
        <div class="row" style="display:none">
          <span>Ticks:</span>
          <strong class="num" id="ticks">0</strong>
        </div>
        <div class="row" style="display:none">
          <span>Unbanked:</span>
          <strong class="num" id="unbanked">0.0</strong>
        </div>
      </div>
    </div>
  </div>

    <!-- JavaScript for interactive functionality -->
    <script>
    // Save key for localStorage
    const SAVE_KEY = "bountySaveV1";

    // Crew types data structure
    const crewTypes = [
      {
        id: "novice",
        name: "Novice Hunter",
        baseCost: 20,
        scaling: 1.15,
        perTick: 0.5,
        count: 0,
        revealed: false,
      },
      // Future crew types can be added here
    ];

    // Game state
    const state = {
      credits: 0,
      ticks: 0,
      unbanked: 0,
    };

    const $ = id => document.getElementById(id);
    const fmt0 = n => n.toLocaleString(undefined, { maximumFractionDigits: 0 });
    const fmt1 = n => n.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 });

    // Calculate the cost for a crew type
    function getCrewCost(crew) {
      return Math.floor(crew.baseCost * Math.pow(crew.scaling, crew.count));
    }

    function updateUI() {
      $("credits").textContent = fmt0(state.credits);
      $("ticks").textContent = fmt0(state.ticks);
      const u = document.getElementById("unbanked");
      if (u) u.textContent = fmt1(state.unbanked);

      // Novice Hunter UI
      const novice = crewTypes[0];
      const hireCostSpan = document.getElementById("hireCostSpan");
      const hireCostBelow = document.getElementById("hireCostBelow");
      if (hireCostSpan) {
        hireCostSpan.textContent = `Hired: ${novice.count}`;
      }
      if (hireCostBelow) {
        hireCostBelow.textContent = `Cost ${getCrewCost(novice)}`;
      }
      const hirePerTick = document.getElementById("hirePerTick");
      if (hirePerTick) {
        if (novice.count === 0) {
          hirePerTick.textContent = `+${novice.perTick} credits/tick`;
        } else {
          const totalPerTick = (novice.count * novice.perTick).toFixed(1);
          hirePerTick.textContent = `+${totalPerTick} credits/tick`;
        }
      }
      const hireRow = document.getElementById("hireRow");
      if (hireRow) {
        if (novice.revealed || state.credits >= getCrewCost(novice)) {
          hireRow.style.display = "";
          novice.revealed = true;
        } else {
          hireRow.style.display = "none";
        }
      }
    }

    // Actions
    $("huntBtn").addEventListener("click", () => {
      state.credits += 1;
      updateUI();
    });

    const hireBtn = document.getElementById("hireBtn");
    if (hireBtn) {
      hireBtn.addEventListener("click", () => {
        const novice = crewTypes[0];
        const cost = getCrewCost(novice);
        if (state.credits < cost) return;
        state.credits -= cost;
        novice.count += 1;
        updateUI();
      });
    }

    // Tick and banking
    const TICK_MS = 1000;
    const tickId = setInterval(() => {
      state.ticks += 1;

      // Calculate passive income from all crew
      let passivePerTick = 0;
      for (const crew of crewTypes) {
        passivePerTick += crew.count * crew.perTick;
      }
      state.unbanked += passivePerTick;

      // Bank only whole credits
      const whole = Math.floor(state.unbanked);
      if (whole > 0) {
        state.credits += whole;
        state.unbanked -= whole;
      }

      updateUI();
    }, TICK_MS);

    // Persistence
    let suppressSaves = false;

    function save() {
      if (suppressSaves) return;
      // Save both state and crewTypes
      localStorage.setItem(SAVE_KEY, JSON.stringify({ state, crewTypes }));
    }

    function load() {
      const raw = localStorage.getItem(SAVE_KEY);
      if (!raw) return;
      try {
        const data = JSON.parse(raw);
        Object.assign(state, data.state || {});
        if (Array.isArray(data.crewTypes)) {
          for (let i = 0; i < crewTypes.length; ++i) {
            Object.assign(crewTypes[i], data.crewTypes[i]);
          }
        }
      } catch {}
    }

    // Load once, then autosave every 60s
    load();
    updateUI();
    const autosaveId = setInterval(save, 60_000);

    // Save when tab is hidden, unless we are resetting
    const onVis = () => {
      if (document.hidden && !suppressSaves) save();
    };
    document.addEventListener("visibilitychange", onVis);

    // Reset Save button functionality
    const resetBtn = document.getElementById("resetBtn");
    if (resetBtn) {
      resetBtn.addEventListener("click", () => {
        // Block any further saves, stop timers, and unbind handlers
        suppressSaves = true;
        document.removeEventListener("visibilitychange", onVis);
        clearInterval(autosaveId);
        clearInterval(tickId);

        // Remove save, then reload
        localStorage.removeItem(SAVE_KEY);
        location.reload();
      });
    }
  </script>
  </body>
</html>