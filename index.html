<!DOCTYPE html>
<!-- The document type declaration for HTML5 -->
<html>
  <head>
    <!-- Set character encoding to UTF-8 -->
    <meta charset="utf-8" />
    <!-- Make the page responsive on all devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Page title -->
    <title>Bounty Office</title>
    <!-- Internal CSS styles for layout and appearance -->
    <style>
      /* Use system fonts for a modern look */
      :root { font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; }
      /* Set body background and text color */
      body { margin: 0; background: #0f1115; color: #e9e9ee; }
      /* Center content and set max width */
      .wrap { max-width: 560px; margin: 0 auto; padding: 24px; }
      /* Style the main heading */
      h1 { margin: 0 0 8px 0; font-size: 26px; }
      /* Card container for main content */
      .card { background: #14151c; border: 1px solid #232333; border-radius: 12px; padding: 14px; }
      /* Row layout for items inside the card */
      .row { display: flex; gap: 8px; align-items: center; margin: 10px 0; }
      /* Use tabular numbers for credit display */
      .num { font-variant-numeric: tabular-nums; }
      /* Style the button */
      button { padding: 10px 12px; border-radius: 10px; border: 1px solid #2b2b3a; background: #1b1b25; color: #fff; cursor: pointer; }
      /* Button hover effect */
      button:hover { background: #20212a; }
    </style>
  <body>
    <!-- Main wrapper for page content -->
  <!-- Reset Save Button in top right -->
  <button id="resetBtn" style="position: absolute; top: 18px; right: 24px; z-index: 10; padding: 8px 14px; border-radius: 8px; border: 1px solid #2b2b3a; background: #1b1b25; color: #fff; cursor: pointer;">Reset Save</button>
  <div class="wrap">
      <!-- Page title -->
      <h1>Bounty Office</h1>
      <!-- Card displays credits and action button -->
      <div class="card">
          <div class="row">
            <span>Credits:</span>
            <strong class="num" id="credits">0</strong>
          </div>
          <div class="row">
            <button id="huntBtn">Hunt petty bounty</button>
            <span>+1 credit</span>
          </div>
          <div class="row" id="hireRow" style="display:none">
            <button id="hireBtn">Hire Novice Hunter</button>
            <span id="hireCostSpan">Cost 20. Adds +0.1 per tick</span>
          </div>
          <div class="row" style="display:none">
            <span>Ticks:</span>
            <strong class="num" id="ticks">0</strong>
          </div>
          <div class="row" style="display:none">
            <span>Unbanked:</span>
            <strong class="num" id="unbanked">0.0</strong>
          </div>
        </div>
    </div>

    <!-- JavaScript for interactive functionality -->
    <script>
    // Save key for localStorage
    const SAVE_KEY = "bountySaveV1";

    // Game state
    const state = {
      credits: 0,
      ticks: 0,
      unbanked: 0,
      passivePerTick: 0,
      noviceCount: 0, // Number of Novice Hunters hired
      hireRevealed: false, // Tracks if hire button has ever been revealed
    };

    const $ = id => document.getElementById(id);
    const fmt0 = n => n.toLocaleString(undefined, { maximumFractionDigits: 0 });
    const fmt1 = n => n.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 });

    // Calculate the cost for the next Novice Hunter (scaling: base 20, x1.15^count)
    function getNoviceCost() {
      return Math.floor(20 * Math.pow(1.15, state.noviceCount));
    }

    function updateUI() {
      $("credits").textContent = fmt0(state.credits);
      $("ticks").textContent = fmt0(state.ticks);
      const u = document.getElementById("unbanked");
      if (u) u.textContent = fmt1(state.unbanked);

      // Update hire cost and count display
      const hireCostSpan = document.getElementById("hireCostSpan");
      if (hireCostSpan) {
        hireCostSpan.textContent = `Cost ${getNoviceCost()}. Adds +0.1 per tick. Hired: ${state.noviceCount}`;
      }

      const hireRow = document.getElementById("hireRow");
      if (hireRow) {
        // Track if the hire button has ever been revealed
        if (state.hireRevealed || state.credits >= getNoviceCost()) {
          hireRow.style.display = "";
          state.hireRevealed = true;
        } else {
          hireRow.style.display = "none";
        }
      }
    }

    // Actions
    $("huntBtn").addEventListener("click", () => {
      state.credits += 1;
      updateUI();
    });

    const hireBtn = document.getElementById("hireBtn");
    if (hireBtn) {
      hireBtn.addEventListener("click", () => {
        const cost = getNoviceCost();
        if (state.credits < cost) return; // Not enough credits
        state.credits -= cost;
        state.passivePerTick += 0.1; // Each purchase adds passive income
        state.noviceCount = (state.noviceCount || 0) + 1;
        updateUI();
      });
    }

    // Tick and banking
    const TICK_MS = 1000;
    const tickId = setInterval(() => {
      state.ticks += 1;

      // Grow unbanked by passive income
      state.unbanked += state.passivePerTick;

      // Bank only whole credits
      const whole = Math.floor(state.unbanked);
      if (whole > 0) {
        state.credits += whole;
        state.unbanked -= whole;
      }

      updateUI();
    }, TICK_MS);

    // Persistence
    let suppressSaves = false;

    function save() {
      if (suppressSaves) return;
      localStorage.setItem(SAVE_KEY, JSON.stringify(state));
    }

    function load() {
      const raw = localStorage.getItem(SAVE_KEY);
      if (!raw) return;
      try {
        const data = JSON.parse(raw);
        Object.assign(state, data);
      } catch {}
    }

    // Load once, then autosave every 60s
    load();
    updateUI();
    const autosaveId = setInterval(save, 60_000);

    // Save when tab is hidden, unless we are resetting
    const onVis = () => {
      if (document.hidden && !suppressSaves) save();
    };
    document.addEventListener("visibilitychange", onVis);

    // Reset Save button functionality
    const resetBtn = document.getElementById("resetBtn");
    if (resetBtn) {
      resetBtn.addEventListener("click", () => {
        // Block any further saves, stop timers, and unbind handlers
        suppressSaves = true;
        document.removeEventListener("visibilitychange", onVis);
        clearInterval(autosaveId);
        clearInterval(tickId);

        // Remove save, then reload
        localStorage.removeItem(SAVE_KEY);
        location.reload();
      });
    }
  </script>
  </body>
</html>